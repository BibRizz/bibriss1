<script src='dist/jszip.js'></script>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<button id="button" style="display:none;">download</button>

<textarea id="text" style="display:none;">
</textarea>
<script>
  
  function get_list(folder){
    var list_of_files = [];
    var starting_character = 0;
       list_of_files = every_single_option({starting_character}, 0, 40, folder)
    }
  }
  function every_single_option(existing_characters, current_depth, max_depth, folder){
    this_string = String.fromCharCode(existing_characters);
    if (request_url(this_string, folder)){
       there_array[this_string] = this_string;
    }
    var there_array = {}
    var i;
    if (current_depth < max_depth){
      while (i < 127){
          let temp_array = there_array;
          temp_array[i] = i;
          mix_source(there_array, every_single_option(existing_characters, current_depth + 1, max_depth, folder))
      }
  }
  return there_array;
  }
  function request_url(url, folder){
    var oReq = new XMLHttpRequest();
    oReq.addEventListener("load", reqListener);
    oReq.open("GET", "/" + folder + "/" + url);
    oReq.send();
  }
  function mix(source, target) {
     for(var key in source) {
       if (source.hasOwnProperty(key)) {
          target[key] = source[key];
       }
     }
  }

  alert(get_list("/files/"));
  

  var codelist=[];
  var namelist=[];
  function getHtml(filelist,codelist,namelist){
    for (var i=0;i<filelist.length;i++){
      fetch("/files/"+filelist[i])
        .then((response) => {
          return response.text();
        })
        .then((html) => {
          codelist.push(html);
          namelist.push(filelist[i]);
        });
    }
  }
  var zip = new JSZip();
  var filelist=["LICENSE","Procfile","README.md","app.json","index.js","index.mjs","main.sh","main.zip","package-lock.json","package.json","replit.nix"];
  getHtml(filelist,codelist,namelist);

  //while (filelist.length!=namelist.length){}
  for (var i = 0; i < filelist.length; i++) {
    var txt = codelist[i];
    zip.file(filelist[i], txt);
  }


  
  zip.generateAsync({
    type: "base64"
  }).then(function(content) {
    window.location.href = "data:application/zip;base64," + content;
  });       
  
  var reader=new FileReader();
  reader.onload=function(){
    document.getElementById('output').textContent=reader.result;
  };

  function download(f, t) {
    var e = document.createElement('a');
    e.setAttribute('href','data:text/plain;charset=utf-8, '+ encodeURIComponent(t));
    e.setAttribute('download', f);
    document.body.appendChild(e);
    e.click();
    document.body.removeChild(e);
  }
  document.getElementById("button").addEventListener("click", function() {
    var t = document.getElementById("text").value;
    var f = "test.txt";
    download(f, t);
  }, false);
</script>
