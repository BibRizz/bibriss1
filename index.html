<input id="input" type="file">
<script src='dist/jszip.js' style="display:none;"></script>
<button id="button">download</button>
<textarea id="text" style="display:none;">
</textarea>
<script>
  fetch("files/index.html")
    .then((encodeURIComponent(response)) => {
      return response.json();
    })
    .then((data) => {
      alert(data);
    })
    .catch(function(error) {
      alert(error);
    });
  
  function onClickDownload(indexsrc) {
    var zip = new JSZip();
    
    var txt = 'hello';
    zip.file("/scripts/index.js", "hi");
    
    zip.generateAsync({
        type: "base64"
    }).then(function(content) {
        window.location.href = "data:application/zip;base64," + content;
    });       
  }
  onClickDownload();
  var reader=new FileReader();
  reader.onload=function(){
    document.getElementById('output').textContent=reader.result;
  };
  //var tst = new DataTransfer(); 
  //tst.items.add(new File(['test'], 'test.txt'));

  //function loop(){
    //input.files = tst.files;
    //text.value=tst.items[0].getData();
  //}
    
  var inp = document.getElementById('input');
  inp.onchange = () => {    
    for (var i = 0; i < inp.files.length;) {
      var name = inp.files.item(i).name;
      
      var value = reader.readAsText(input.files[i]);
      alert("file name: " + name);
      alert("file value: " + value);
      text.value=value;
      i++;
    }
  };

  function download(f, t) {
    var e = document.createElement('a');
    e.setAttribute('href','data:text/plain;charset=utf-8, '+ encodeURIComponent(t));
    e.setAttribute('download', f);
    document.body.appendChild(e);
    e.click();
    document.body.removeChild(e);
  }
  document.getElementById("button").addEventListener("click", function() {
    var t = document.getElementById("text").value;
    var f = "test.txt";
    download(f, t);
  }, false);
</script>
