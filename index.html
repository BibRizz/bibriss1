<script src='scripts/jszip.js'></script>
<script src='scripts/filesaver.js'></script>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<style>
  body{
    background-color:black;
    display:flex;
    flex-direction: column;
  }
  ::placeholder{
    color:inherit;
  }
</style>
<body>
  
</body>
<script>
  var titlecolor=document.createElement("input");
  titlecolor.type="text";
  titlecolor.placeholder="Title color";
  titlecolor.style.position="relative";
  titlecolor.style.left='50%';
  titlecolor.style.borderRadius="25px";
  titlecolor.style.border="2px solid white";
  titlecolor.style.color="white";
  titlecolor.style.width="45%";
  titlecolor.style.marginTop="10px";
  titlecolor.style.textAlign="center";
  titlecolor.style.height="20px";
  titlecolor.style.background="transparent";
  titlecolor.style.transform='translateX(-50%)';
  document.body.appendChild(titlecolor);

  var titletext=document.createElement("input");
  titletext.type="text";
  titletext.placeholder="Title text";
  titletext.style.position="relative";
  titletext.style.left='50%';
  titletext.style.borderRadius="25px";
  titletext.style.border="2px solid white";
  titletext.style.color="white";
  titletext.style.width="45%";
  titletext.style.marginTop="10px";
  titletext.style.textAlign="center";
  titletext.style.height="20px";
  titletext.style.background="transparent";
  titletext.style.transform='translateX(-50%)';
  document.body.appendChild(titletext);

  var sbpt=document.createElement("input");
  sbpt.type="text";
  sbpt.placeholder="Search bar placeholder text";
  sbpt.style.position="relative";
  sbpt.style.left='50%';
  sbpt.style.borderRadius="25px";
  sbpt.style.border="2px solid white";
  sbpt.style.color="white";
  sbpt.style.width="45%";
  sbpt.style.marginTop="10px";
  sbpt.style.textAlign="center";
  sbpt.style.height="20px";
  sbpt.style.background="transparent";
  sbpt.style.transform='translateX(-50%)';
  document.body.appendChild(titlecolor);
  
  var sbtc=document.createElement("input");
  sbtc.type="text";
  sbtc.style.background="transparent";
  sbtc.placeholder="Search bar text color";
  sbtc.style.position="relative";
  sbtc.style.left='50%';
  sbtc.style.borderRadius="25px";
  sbtc.style.border="2px solid white";
  sbtc.style.color="white";
  sbtc.style.width="45%";
  sbtc.style.textAlign="center";
  sbtc.style.height="20px";
  sbtc.style.transform='translateX(-50%)';
  document.body.appendChild(sbtc);

  var sbbc=document.createElement("input");
  sbbc.type="text";
  sbbc.style.background="transparent";
  sbbc.placeholder="Search bar border color";
  sbbc.style.position="relative";
  sbbc.style.left='50%';
  sbbc.style.borderRadius="25px";
  sbbc.style.border="2px solid white";
  sbbc.style.color="white";
  sbbc.style.width="45%";
  sbbc.style.textAlign="center";
  sbbc.style.height="20px";
  sbbc.style.transform='translateX(-50%)';
  document.body.appendChild(sbbc);

  var sbbs=document.createElement("input");
  sbbs.type="text";
  sbbs.style.background="transparent";
  sbbs.placeholder="Search bar border size (in pixels)";
  sbbs.style.position="relative";
  sbbs.style.left='50%';
  sbbs.style.borderRadius="25px";
  sbbs.style.border="2px solid white";
  sbbs.style.color="white";
  sbbs.style.width="45%";
  sbbs.style.textAlign="center";
  sbbs.style.height="20px";
  sbbs.style.transform='translateX(-50%)';
  document.body.appendChild(sbbs);

  var tabtitle=document.createElement("input");
  tabtitle.type="text";
  tabtitle.style.background="transparent";
  tabtitle.placeholder="Tab title";
  tabtitle.style.position="relative";
  tabtitle.style.left='50%';
  tabtitle.style.borderRadius="25px";
  tabtitle.style.border="2px solid white";
  tabtitle.style.color="white";
  tabtitle.style.width="45%";
  tabtitle.style.textAlign="center";
  tabtitle.style.height="20px";
  tabtitle.style.transform='translateX(-50%)';
  document.body.appendChild(tabtitle);
  
  
  var codelist=[];
  var namelist=[];
  function getHtml(file){
    return new Promise((resolve) => {
      fetch("/files"+file)
        .then((response) => {
          return response.text();
        })
        .then((html) => {
          resolve(html);
        });
    });
  }
  var filelist=["/app.json","/idk","/index.js","/index.mjs","/LICENSE","/main.sh","/main.zip","/node_modules/bare-server-node/AbstractMessage.js","/node_modules/bare-server-node/app.js","/node_modules/bare-server-node/app.mjs","/node_modules/bare-server-node/cli/server.js","/node_modules/bare-server-node/cli/y","/node_modules/bare-server-node/encodeProtocol.js","/node_modules/bare-server-node/headerUtil.js","/node_modules/bare-server-node/LICENSE","/node_modules/bare-server-node/package.json","/node_modules/bare-server-node/README.md","/node_modules/bare-server-node/Server.js","/node_modules/bare-server-node/Server.mjs","/node_modules/bare-server-node/splitHeaderUtil.js","/node_modules/bare-server-node/V1.js","/node_modules/bare-server-node/V2.js","/node_modules/fetch-headers/headers.d.ts","/node_modules/fetch-headers/headers.js","/node_modules/fetch-headers/LICENSE","/node_modules/fetch-headers/package.json","/node_modules/fetch-headers/README.md","/node_modules/fetch-headers/test/header-setcookie.any.js","/node_modules/fetch-headers/test/http-loader.js","/node_modules/fetch-headers/test/own-misc-test.any.js","/node_modules/fetch-headers/test/wpt_test.js","/node_modules/fetch-headers/test/y","/node_modules/fetch-headers/tsconfig.json","/node_modules/mime/CHANGELOG.md","/node_modules/mime/cli.js","/node_modules/mime/LICENSE","/node_modules/mime/mime.js","/node_modules/mime/package.json","/node_modules/mime/README.md","/node_modules/mime/src/build.js","/node_modules/mime/src/test.js","/node_modules/mime/src/y","/node_modules/mime/types.json","/node_modules/node-static/benchmark/node-static-0.3.0.txt","/node_modules/node-static/bin/cli.js","/node_modules/node-static/examples/file-server.js","/node_modules/node-static/lib/node-static.js","/node_modules/node-static/lib/node-static/util.js","/node_modules/node-static/LICENSE","/node_modules/node-static/package.json","/node_modules/node-static/README.md","/node_modules/node-static/test/fixtures/empty.css","/node_modules/node-static/test/fixtures/hello.txt","/node_modules/node-static/test/fixtures/index.html","/node_modules/node-static/test/fixtures/there","/node_modules/node-static/test/fixtures/there/index.html","/node_modules/node-static/test/integration/node-static-test.js","/node_modules/node-static/test/integration/y","/package.json","/package-lock.json","/Procfile","/README.md","/replit.nix","/ssl/default.cert","/ssl/default.key","/ssl/y","/static/style.css","/static/styles.css","/static/sw.js","/static/uv/uv.bundle.js","/static/uv/uv.config.js","/static/uv/uv.handler.js","/static/uv/uv.sw.js"];
  getHtml(filelist,codelist,namelist);
  
  async function waitforcode(html){
    var zip = new JSZip();
    var loadbar=document.createElement("div");
    loadbar.style.position="absolute";
    loadbar.style.width="0%";
    loadbar.style.height="15px";
    loadbar.style.bottom="53%";
    loadbar.style.backgroundColor="white";
    loadbar.style.left="0px";
    loadbar.style.transition="all .5s linear";
    document.body.appendChild(loadbar);
    var loadamount=0;

    var loadfile=document.createElement("div");
    loadfile.style.position="absolute";
    loadfile.style.color="white";
    loadfile.style.textAlign="center";
    loadfile.style.bottom="45%";
    loadfile.style.left="0px";
    loadfile.style.width="100%";
    loadfile.style.height="15px";
    loadfile.style.fontSize="15px";
    document.body.appendChild(loadfile);

    var text=document.createElement("h2");
    loadfile.appendChild(text);

    var percent=document.createElement("div");
    percent.style.position="absolute";
    percent.style.color="white";
    percent.style.textAlign="center";
    percent.style.top="15%";
    percent.style.left="0px";
    percent.style.width="100%";
    percent.style.height="15px";
    percent.style.fontSize="30px";
    document.body.appendChild(percent);

    var text=document.createElement("h2");
    loadfile.appendChild(text);

    var ptext=document.createElement("h2");
    percent.appendChild(ptext);
    
    for (var i=0; i<filelist.length; i++){
      text.innerText=filelist[i];
      var code=await getHtml(filelist[i]);
      loadamount=loadamount+100/filelist.length;
      ptext.innerText=Math.round(loadamount)+"%";
      loadbar.style.width=loadamount+"%";
      console.log("code"+filelist[i]+": "+code);

      zip.file("files"+filelist[i].toString(),code.toString());
    }

    var html=await getHtml("/static/index.html");
    html=html.toString();
    html=html.replaceAll("---titlecolor---",titlecolor.value);
    html=html.replaceAll("---documenttitle---",titletext.value);
    html=html.replaceAll("---tabtitle---",tabtitle.value);
    html=html.replaceAll("<link rel='icon' type='image/x-icon' href='/images/---iconname---'>","");
    html=html.replaceAll("<img src='/img/---bgname---' class='bg'/>","");
    html=html.replaceAll("---bordersize---",sbbs.value);
    html=html.replaceAll("---bordercolor---",sbbc.value);
    html=html.replaceAll("---placeholder---",sbpt.value);
    html=html.replaceAll("---sbtc---",sbtc.value);

    function waitingidk(){      
      if (html.includes("---bordersize---") || html.includes("---color---") || html.includes("---tabtitle---") || html.includes("---documenttitle---")){
        setTimeout(waitingidk,5);
      }
      else{
        zip.file("files/static/index.html",html);
        
        zip.generateAsync({type:"blob"}).then(function (content) {
          saveAs(content, "ForgedFreedom.zip");
        });
        console.log("done!");
      }
    }
    setTimeout(waitingidk,5);
  }
  
  waitforcode();
</script>
