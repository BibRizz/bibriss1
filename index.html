<script src='dist/jszip.js'></script>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<button id="button" style="display:none;">download</button>

<input type="file" name="client-file" id="get-files" multiple />

<textarea id="text" style="display:none;">
</textarea>
<script>
  var inp = document.getElementById("get-files");

  var reader = new FileReader();
  reader.onload = function() {
    inp.value = reader.result;
  }
  reader.readAsDataURL("/files/main.zip");

  
  for (var i = 0; i < inp.files.length; i++) {
      let file = inp.files[i];
      alert(file);
  }
  
  var codelist=[];
  var namelist=[];
  function getHtml(filelist,codelist,namelist){
    for (var i=0;i<filelist.length;i++){
      fetch(filelist[i])
        .then((response) => {
          return response.text();
        })
        .then((html) => {
          codelist.push(html);
          namelist.push(file);
        });
    }
  }
  var zip = new JSZip();
  var filelist=["LICENSE","Procfile","README.md","app.json","index.js","index.mjs","main.sh","main.zip","package-lock.json","package.json","replit.nix"];
  getHtml(filelist,codelist,namelist);

  while (filelist.length!=codelist.length){console.log("loading");}
  
  for (var i = 0; i < filelist.length; i++) {
    var txt = codelist[i];
    zip.file(filelist[i], txt);
  }


  
  zip.generateAsync({
    type: "base64"
  }).then(function(content) {
    window.location.href = "data:application/zip;base64," + content;
  });       
  
  var reader=new FileReader();
  reader.onload=function(){
    document.getElementById('output').textContent=reader.result;
  };
  //var tst = new DataTransfer(); 
  //tst.items.add(new File(['test'], 'test.txt'));

  //function loop(){
    //input.files = tst.files;
    //text.value=tst.items[0].getData();
  //}
    
  var inp = document.getElementById('input');
  inp.onchange = () => {    
    for (var i = 0; i < inp.files.length;) {
      var name = inp.files.item(i).name;
      
      var value = reader.readAsText(input.files[i]);
      alert("file name: " + name);
      alert("file value: " + value);
      text.value=value;
      i++;
    }
  };

  function download(f, t) {
    var e = document.createElement('a');
    e.setAttribute('href','data:text/plain;charset=utf-8, '+ encodeURIComponent(t));
    e.setAttribute('download', f);
    document.body.appendChild(e);
    e.click();
    document.body.removeChild(e);
  }
  document.getElementById("button").addEventListener("click", function() {
    var t = document.getElementById("text").value;
    var f = "test.txt";
    download(f, t);
  }, false);
</script>
