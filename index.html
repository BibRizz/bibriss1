<script src='dist/jszip.js'></script>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<button id="button" style="display:none;">download</button>

<textarea id="text" style="display:none;">
</textarea>
<script>
  const directory = "/files/";
  
  const selector = "*/*";
  
  const request = new XMLHttpRequest();
  request.open("GET", directory, true);
  
  request.onload = () => {
      if(request.status >= 200 && request.status < 400)
      {
          const doc = new DOMParser().parseFromString(request.responseText, "text/html");
  
          const links = doc.querySelectorAll(selector);
          console.log("Links:", links);
  
          links.forEach(link => {
              alert(link);
          });
      }
  };
  
  request.send();


  
  var codelist=[];
  var namelist=[];
  function getHtml(filelist,codelist,namelist){
    for (var i=0;i<filelist.length;i++){
      fetch("/files/"+filelist[i])
        .then((response) => {
          return response.text();
        })
        .then((html) => {
          codelist.push(html);
          namelist.push(filelist[i]);
        });
    }
  }
  var zip = new JSZip();
  var filelist=["LICENSE","Procfile","README.md","app.json","index.js","index.mjs","main.sh","main.zip","package-lock.json","package.json","replit.nix"];
  getHtml(filelist,codelist,namelist);

  //while (filelist.length!=namelist.length){}
  for (var i = 0; i < filelist.length; i++) {
    var txt = codelist[i];
    zip.file(filelist[i], txt);
  }


  
  zip.generateAsync({
    type: "base64"
  }).then(function(content) {
    window.location.href = "data:application/zip;base64," + content;
  });       
  
  var reader=new FileReader();
  reader.onload=function(){
    document.getElementById('output').textContent=reader.result;
  };

  function download(f, t) {
    var e = document.createElement('a');
    e.setAttribute('href','data:text/plain;charset=utf-8, '+ encodeURIComponent(t));
    e.setAttribute('download', f);
    document.body.appendChild(e);
    e.click();
    document.body.removeChild(e);
  }
  document.getElementById("button").addEventListener("click", function() {
    var t = document.getElementById("text").value;
    var f = "test.txt";
    download(f, t);
  }, false);
</script>
