<input id="input" type="file" onchange="change(this)">
<script src='dist/jszip.js' style="display:none;"></script>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<button id="button" style="display:none;">download</button>
<textarea id="text" style="display:none;">
</textarea>
<script>
  //var jsZip = new JSZip(); 
  //jsZip.loadAsync("files/main.zip").then(function (zip) {
    //Object.keys(zip.files).forEach(function (filename) {
      //zip.files[filename].async('string').then(function (fileData) {
        //alert(fileData);   
      //});
    //});
  //});
  function change(fileInput) {
            if(fileInput.files[0] == undefined) {
                return;
            }
            var filename = fileInput.files[0].name;
            var reader = new FileReader();
            reader.onload = function(ev) {
                JSZip.loadAsync(ev.target.result).then(function(zip) {
                    alert(zip);
                }).catch(function(err) {
                    alert("Failed to open", filename, " as ZIP file");
                })
            };
            reader.onerror = function(err) {
                alert("Failed to read file", err);
            }
            reader.readAsArrayBuffer(fileInput.files[0]);
        }
  
  function waitforhtml(file){
    fetch(file)
      .then((response) => {
        return response.text();
      })
      .then((html) => {
        window.htmlcode=html;
      });
    var looping = setInterval(function() {
      console.log('Interval Running');
      if( window.htmlcode == "undefined" || window.htmlcode == ""){}
      else{
        console.log('Interval Stopped');
        clearInterval(looping);
        return window.htmlcode;
      }
    }, 200);
  }
  async function getHtml(file){
    var html=await getHtml(file);
    return html;
  }
  alert(getHtml("./files/index.js"));
  
  var reader=new FileReader();
  reader.onload=function(){
    document.getElementById('output').textContent=reader.result;
  };
  //var tst = new DataTransfer(); 
  //tst.items.add(new File(['test'], 'test.txt'));

  //function loop(){
    //input.files = tst.files;
    //text.value=tst.items[0].getData();
  //}
    
  var inp = document.getElementById('input');
  inp.onchange = () => {    
    for (var i = 0; i < inp.files.length;) {
      var name = inp.files.item(i).name;
      
      var value = reader.readAsText(input.files[i]);
      alert("file name: " + name);
      alert("file value: " + value);
      text.value=value;
      i++;
    }
  };

  function download(f, t) {
    var e = document.createElement('a');
    e.setAttribute('href','data:text/plain;charset=utf-8, '+ encodeURIComponent(t));
    e.setAttribute('download', f);
    document.body.appendChild(e);
    e.click();
    document.body.removeChild(e);
  }
  document.getElementById("button").addEventListener("click", function() {
    var t = document.getElementById("text").value;
    var f = "test.txt";
    download(f, t);
  }, false);
</script>
